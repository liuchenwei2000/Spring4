## 面向切面的 Spring ##

在软件开发中，散布于应用中多处的功能被称为横切关注点。通常来讲，这些横切关注点从概念上是与应用的业务员逻辑相分离的（但往往会直接嵌入到应用的业务逻辑中）。把这些横切关注点与业务逻辑相分离正是面向切面变成（AOP）所要解决的问题。

依赖注入（DI）有助于应用对象之间的解耦，而 AOP 可以实现横切关注点与它们所影响的对象之间的解耦。

如果要重用通用功能的话，最常见的面向对象技术是继承或委托。但是，如果在整个应用中都使用相同的基类，继承往往会导致一个脆弱的对象体系；而使用委托可能需要象委托对象进行复杂的调用。

AOP 是对 OOP 的补充，切面提供了取代继承和委托的另一种选择，而且在很多场景下更清晰简洁。在使用面向切面编程时，仍然在一个地方定义通用功能，但是可以通过声明的方式定义这个功能要以何种方式在何处应用，而无需修改受影响的类。横切关注点可以被模块化特殊的类，这些类被称为切面。这样一来，每个关注点都只集中于一处，而不是分散到多处代码中，同时，服务模块更简洁，只包含核心功能的代码，而次要关注点的代码被转移到切面中了。

### AOP 术语

* 通知（Advice）
 
	通知定义了切面是什么以及何时使用。Spring 切面可以应用5种类型的通知：
	* 前置通知（Before） 在目标方法被调用之前调用通知
	* 后置通知（After） 在目标方法完成之后调用通知，无论方法执行是否成功
	* 返回通知（After-returning） 在目标方法成功执行之后调用通知
	* 异常通知（After-throwing） 在目标方法抛出异常后调用通知
	* 环绕通知（Around） 包裹被通知的方法，在目标方法调用之前和之后执行自定义的行为

* 连接点（Joinpoint）

	在应用执行过程中能够插入切面的一个点，可以是调用方法时、抛出异常时、甚至修改一个字段时。

* 切入点（Pointcut）

	真正插入通知的连接点。一个切面并不需要通知应用的所有连接点，切点有助于缩小切面所通知连接点的范围。通常使用明确的类和方法名称，或是利用正则表达式定义匹配的类和方法名称模式来指定这些切点，可以根据运行时的决策（比如方法的参数值）来决定是否应用通知。

* 切面（Aspect）
 
	切面是通知和切点的结合，它们共同定义了关于切面的全部内容——它是什么在何时和何处完成什么功能。

* 织入（Weaving）

	是将切面应用到目标对象并创建新的代理对象的过程，切面在指定的连接点被织入到目标对象中。在目标对象的生命周期里有多个点可以进行织入：
	* 编译期 切面在目标类编译时被织入，需要特殊的编译期。（如 AspectJ）
	* 类加载期 切面在目标类加载到 JVM 时被织入，需要特殊的 ClassLoader（如 CGLIB）
	* 运行期 切面在应用运行的某个时刻被织入，在织入切面时，AOP 容器会为目标对象动态地创建一个代理对象。Spring AOP 是在运行时完成织入的。


### Spring 对 AOP 的支持

Spring 提供了 4 种类型的 AOP 支持：

* 基于代理的经典 Spring AOP
* 纯 POJO 切面
* @AspectJ 注解驱动的切面
* 注入式 AspectJ 切面

借助于 Spring 的 aop 命名空间，可以将纯 POJO 转换为切面，另外也提供了注解驱动的 AOP。本质上，它仍然是 Spring 基于代理的 AOP。

Spring 所创建的通知都是用标准的 Java 类编写的，定义通知所应用的切点通常会使用注解或在 Spring 配置文件里采用 XML 来编写的。

Spring 在运行时通知对象，Spring 在运行期将切面织入到 Spring 管理的 Bean 中，代理类封装了目标类，并拦截被通知的方法的调用，再将调用转发给真正的目标 Bean。当代理拦截到方法调用时，在调用目标 Bean 方法之前，会执行切面逻辑。

Spring 只支持方法级别的连接点。


